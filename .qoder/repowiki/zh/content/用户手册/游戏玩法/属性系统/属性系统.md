# 属性系统

<cite>
**本文档引用文件**  
- [Life_User_Manual.md](file://Life_User_Manual.md)
- [LifePlayer.java](file://Life\src\main\java\com\bot\life\dao\entity\LifePlayer.java#L56-L76)
- [ENAttribute.java](file://Game\src\main\java\com\bot\game\enums\ENAttribute.java#L12-L17)
- [BattleServiceImpl.java](file://Game\src\main\java\com\bot\game\service\impl\BattleServiceImpl.java#L128-L148)
- [GameConsts.java](file://Common\src\main\java\com\bot\common\constant\GameConsts.java#L190-L202)
- [AddAttributeServiceImpl.java](file://Game\src\main\java\com\bot\game\service\impl\AddAttributeServiceImpl.java#L39-L40)
- [ResetAttributeServiceImpl.java](file://Game\src\main\java\com\bot\game\service\impl\ResetAttributeServiceImpl.java#L43-L47)
</cite>

## 目录
1. [属性系统概述](#属性系统概述)  
2. [基础属性与战斗属性](#基础属性与战斗属性)  
3. [属性克制关系](#属性克制关系)  
4. [属性点分配与角色成长](#属性点分配与角色成长)  
5. [属性计算流程](#属性计算流程)  
6. [属性系统相关操作](#属性系统相关操作)

## 属性系统概述

浮生卷游戏中的属性系统是角色成长和战斗机制的核心组成部分。该系统分为基础属性和战斗属性两大类，通过基础属性的提升来影响战斗属性，从而决定角色在战斗中的表现。属性系统还包含五行相克机制，影响战斗中的伤害输出和防御效果。

**本节来源**  
- [Life_User_Manual.md](file://Life_User_Manual.md#L44-L65)

## 基础属性与战斗属性

### 基础属性

基础属性是角色的核心成长指标，直接影响战斗属性的数值。根据《Life_User_Manual.md》和`LifePlayer.java`中的实现，基础属性包括：

- **速度**：决定角色的出手顺序，同时影响破防能力
- **体质**：影响角色的最大血量和防御力
- **灵力**：影响会心率（暴击率）和会心效果（暴击伤害倍数）
- **力量**：影响攻击力和破防能力

### 战斗属性

战斗属性是基于基础属性计算得出的实战指标，包括：

- **血量/最大血量**：角色的生命值
- **攻击力**：普通攻击的伤害输出
- **防御**：减少受到的伤害
- **会心率**：触发暴击的概率
- **会心效果**：暴击时的伤害倍数
- **破防**：无视对方防御的比例

### 属性计算公式

根据`LifePlayer.java`中的`calculateExtendedAttributes()`方法，各基础属性对战斗属性的影响如下：

```java
// 每增加1点速度，破防随之增加0.005%
this.armorBreak = BigDecimal.valueOf(speed * 0.005);

// 每增加1点体质，血量随之增加10点，防御随之增加1点
this.maxHealth = 10 + constitution * 10;
this.defense = 1 + constitution;

// 每增加1点灵力，会心增加0.01%，会心效果增加0.005%
this.criticalRate = BigDecimal.valueOf(spiritPower * 0.01);
this.criticalDamage = BigDecimal.valueOf(110 + spiritPower * 0.005);

// 每增加1点力量，攻击力增加6点，破防增加0.01%
this.attackPower = 6 + strength * 6;
this.armorBreak = this.armorBreak.add(BigDecimal.valueOf(strength * 0.01));
```

**本节来源**  
- [Life_User_Manual.md](file://Life_User_Manual.md#L46-L65)
- [LifePlayer.java](file://Life\src\main\java\com\bot\life\dao\entity\LifePlayer.java#L56-L76)

## 属性克制关系

### 五行相克机制

浮生卷游戏采用传统的五行相克系统，具体关系如下：

- 金克木
- 木克土
- 土克水
- 水克火
- 火克金

### 克制效果

根据`ENAttribute.java`枚举和`BattleServiceImpl.java`中的实现，属性克制对战斗产生以下影响：

- **克制对方**：最终伤害增加20%
- **被克制**：自身防御减少10%

在代码实现中，`getFigure()`方法根据属性克制关系返回相应的伤害系数：

```java
private Double getFigure(String myAttribute, String targetAttribute) {
    Double figure = GameConsts.BaseFigure.BASE_ONE_NUMBER;
    if (ENAttribute.isBuff(myAttribute, targetAttribute)) {
        figure = GameConsts.BaseFigure.BASE_BUFF_FIGURE; // 1.2倍伤害
    }
    if (ENAttribute.isDeBuff(myAttribute, targetAttribute)) {
        figure = GameConsts.BaseFigure.BASE_DE_BUFF_FIGURE; // 0.8倍防御
    }
    return figure;
}
```

其中，`BASE_BUFF_FIGURE`为1.2，`BASE_DE_BUFF_FIGURE`为0.8，`BASE_ONE_NUMBER`为1.0。

**本节来源**  
- [Life_User_Manual.md](file://Life_User_Manual.md#L68-L72)
- [ENAttribute.java](file://Game\src\main\java\com\bot\game\enums\ENAttribute.java#L12-L17)
- [BattleServiceImpl.java](file://Game\src\main\java\com\bot\game\service\impl\BattleServiceImpl.java#L178-L187)
- [GameConsts.java](file://Common\src\main\java\com\bot\common\constant\GameConsts.java#L200-L202)

## 属性点分配与角色成长

### 属性点获取

玩家通过游戏进程获得属性点，用于提升角色的基础属性。属性点的分配直接影响角色的成长方向和战斗风格。

### 属性点分配方式

根据`AddAttributeServiceImpl.java`中的实现，属性点分配通过反射机制完成：

```java
int subNumber = (Integer) ReflectUtil.getFieldValue(playerPhantom, enPhantomAttribute.getValue());
ReflectUtil.setFieldValue(playerPhantom, enPhantomAttribute.getValue(), subNumber + 1);
```

此代码通过反射获取指定属性的当前值，然后将其增加1，实现属性点的分配。

### 属性重置机制

游戏还提供了属性重置功能，允许玩家调整已分配的属性点。根据`ResetAttributeServiceImpl.java`的实现：

```java
int subNumber = (Integer) ReflectUtil.getFieldValue(playerPhantom, enPhantomAttribute.getValue());
ReflectUtil.setFieldValue(playerPhantom, enPhantomAttribute.getValue(), subNumber - 1);
ENPhantomAttribute phantomAttribute = enPhantomAttributes.get(RandomUtil.randomInt(enPhantomAttributes.size()));
int resetNumber = (Integer) ReflectUtil.getFieldValue(playerPhantom, phantomAttribute.getValue());
ReflectUtil.setFieldValue(playerPhantom, phantomAttribute.getValue(), resetNumber + 1);
```

此机制允许玩家减少某一属性点数，并将这些点数随机分配到其他属性上，为角色成长提供了更大的灵活性。

**本节来源**  
- [AddAttributeServiceImpl.java](file://Game\src\main\java\com\bot\game\service\impl\AddAttributeServiceImpl.java#L39-L40)
- [ResetAttributeServiceImpl.java](file://Game\src\main\java\com\bot\game\service\impl\ResetAttributeServiceImpl.java#L43-L47)

## 属性计算流程

### 战斗属性计算流程

当角色进入战斗时，系统会根据基础属性和等级计算最终的战斗属性。以怪物属性计算为例（`BattleServiceImpl.java`）：

```java
// 攻击力计算
int intAttack = (baseMonster.getAttack() + list.get(0)) * GameConsts.BaseFigure.ATTACK_POINT +
        baseMonster.getLevel() * GameConsts.BaseFigure.ATTACK_FOR_EVERY_LEVEL;
Double figure = this.getFigure(baseMonster.getAttribute(), playerPhantom.getAttribute());
double doubleAttack = intAttack * figure;
battleMonsterDTO.setFinalAttack((int) doubleAttack);

// 速度计算
battleMonsterDTO.setFinalSpeed((baseMonster.getSpeed() + list.get(1)) * GameConsts.BaseFigure.SPEED_POINT +
        baseMonster.getLevel() * GameConsts.BaseFigure.SPEED_FOR_EVERY_LEVEL);

// 防御计算
battleMonsterDTO.setFinalDefense((baseMonster.getPhysique() + list.get(2)) * GameConsts.BaseFigure.DEFENSE_POINT +
        baseMonster.getLevel() * GameConsts.BaseFigure.DEFENSE_FOR_EVERY_LEVEL);

// 血量计算
Integer hp = baseMonster.getPhysique() * GameConsts.BaseFigure.HP_POINT +
        baseMonster.getLevel() * GameConsts.BaseFigure.HP_FOR_EVERY_LEVEL;
```

### 常量定义

战斗属性计算中使用的常量定义在`GameConsts.java`中：

```java
interface BaseFigure {
    Integer SPEED_FOR_EVERY_LEVEL = 2;
    Integer ATTACK_FOR_EVERY_LEVEL = 10;
    Integer HP_FOR_EVERY_LEVEL = 100;
    Integer DEFENSE_FOR_EVERY_LEVEL = 1;
    Integer SPEED_POINT = 1;
    Integer ATTACK_POINT = 3;
    Integer HP_POINT = 10;
    Integer DEFENSE_POINT = 2;
}
```

这些常量确保了属性计算的一致性和可维护性。

**本节来源**  
- [BattleServiceImpl.java](file://Game\src\main\java\com\bot\game\service\impl\BattleServiceImpl.java#L132-L144)
- [GameConsts.java](file://Common\src\main\java\com\bot\common\constant\GameConsts.java#L190-L197)

## 属性系统相关操作

### 属性查看

玩家可以通过游戏主菜单的"查看角色信息"选项来查看详细的属性面板，了解当前的基础属性和战斗属性。

### 属性提升

玩家可以通过以下方式提升属性：
- 使用属性类道具永久增加属性
- 装备提供属性加成的心法、功法等装备
- 通过属性点分配提升基础属性

### 战斗策略

了解属性克制关系对于制定战斗策略至关重要。玩家应根据敌人的属性选择合适的角色属性，以获得战斗优势。例如，面对木属性敌人时，选择金属性角色可以获得20%的伤害加成。

**本节来源**  
- [Life_User_Manual.md](file://Life_User_Manual.md#L89-L96)