# æ•°æ®åº“åˆå§‹åŒ–

<cite>
**æœ¬æ–‡æ¡£å¼•ç”¨çš„æ–‡ä»¶**
- [Life_Database_Init.sql](file://Life_Database_Init.sql)
- [Life_Deployment_Guide.md](file://Life_Deployment_Guide.md)
- [application.properties](file://Boot/src/main/resources/application.properties)
- [application-dev.properties](file://Boot/src/main/resources/application-dev.properties)
</cite>

## ç›®å½•
1. [ç®€ä»‹](#ç®€ä»‹)
2. [æ•°æ®åº“åˆå§‹åŒ–æ¦‚è¿°](#æ•°æ®åº“åˆå§‹åŒ–æ¦‚è¿°)
3. [MySQLè¿æ¥é…ç½®](#mysqlè¿æ¥é…ç½®)
4. [æ•°æ®åº“åˆ›å»ºä¸å­—ç¬¦é›†è®¾ç½®](#æ•°æ®åº“åˆ›å»ºä¸å­—ç¬¦é›†è®¾ç½®)
5. [SQLè„šæœ¬æ‰§è¡Œæµç¨‹](#sqlè„šæœ¬æ‰§è¡Œæµç¨‹)
6. [è¡¨ç»“æ„åˆ†æ](#è¡¨ç»“æ„åˆ†æ)
7. [åˆå§‹åŒ–è„šæœ¬è¯¦è§£](#åˆå§‹åŒ–è„šæœ¬è¯¦è§£)
8. [è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬](#è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬)
9. [æ•…éšœæ’é™¤æŒ‡å—](#æ•…éšœæ’é™¤æŒ‡å—)
10. [æœ€ä½³å®è·µå»ºè®®](#æœ€ä½³å®è·µå»ºè®®)

## ç®€ä»‹

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº†æµ®ç”Ÿå·æ¨¡å—çš„æ•°æ®åº“åˆå§‹åŒ–æµç¨‹ï¼ŒåŸºäºLife_Database_Init.sqlè„šæœ¬çš„å®Œæ•´æ‰§è¡Œè¿‡ç¨‹ã€‚è¯¥è„šæœ¬è´Ÿè´£åˆ›å»ºæ‰€æœ‰å¿…è¦çš„æ•°æ®åº“è¡¨ç»“æ„å¹¶æ’å…¥åˆå§‹æ•°æ®ï¼Œä¸ºæ¸¸æˆç³»ç»Ÿçš„æ­£å¸¸è¿è¡Œå¥ å®šåŸºç¡€ã€‚

## æ•°æ®åº“åˆå§‹åŒ–æ¦‚è¿°

æµ®ç”Ÿå·æ¨¡å—é‡‡ç”¨MySQLä½œä¸ºä¸»è¦æ•°æ®åº“ï¼Œé€šè¿‡ä¸“é—¨çš„åˆå§‹åŒ–è„šæœ¬å»ºç«‹å®Œæ•´çš„æ•°æ®æ¨¡å‹ã€‚æ•´ä¸ªåˆå§‹åŒ–è¿‡ç¨‹åŒ…å«ä»¥ä¸‹å…³é”®æ­¥éª¤ï¼š

- **æ•°æ®åº“åˆ›å»º**ï¼šåˆ›å»ºä¸“ç”¨æ•°æ®åº“å®ä¾‹
- **è¡¨ç»“æ„å®šä¹‰**ï¼šå®šä¹‰22ä¸ªæ ¸å¿ƒä¸šåŠ¡è¡¨
- **æ•°æ®åˆå§‹åŒ–**ï¼šæ’å…¥åŸºç¡€é…ç½®å’Œåˆå§‹æ•°æ®
- **ç´¢å¼•ä¼˜åŒ–**ï¼šå»ºç«‹å¿…è¦çš„ç´¢å¼•æé«˜æŸ¥è¯¢æ€§èƒ½

```mermaid
flowchart TD
A["å¼€å§‹æ•°æ®åº“åˆå§‹åŒ–"] --> B["è¿æ¥MySQLæœåŠ¡å™¨"]
B --> C["åˆ›å»ºæ•°æ®åº“(bot)"]
C --> D["è®¾ç½®å­—ç¬¦é›†(utf8mb4)"]
D --> E["åˆ‡æ¢åˆ°ç›®æ ‡æ•°æ®åº“"]
E --> F["æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬"]
F --> G["åˆ›å»ºè¡¨ç»“æ„"]
G --> H["æ’å…¥åˆå§‹æ•°æ®"]
H --> I["éªŒè¯åˆå§‹åŒ–ç»“æœ"]
I --> J["åˆå§‹åŒ–å®Œæˆ"]
```

**å›¾è¡¨æ¥æº**
- [Life_Deployment_Guide.md](file://Life_Deployment_Guide.md#L12-L26)

## MySQLè¿æ¥é…ç½®

### åŸºæœ¬è¿æ¥è¯­æ³•

æ•°æ®åº“åˆå§‹åŒ–çš„ç¬¬ä¸€æ­¥æ˜¯å»ºç«‹ä¸MySQLæœåŠ¡å™¨çš„è¿æ¥ï¼š

```sql
-- ä½¿ç”¨rootç”¨æˆ·è¿æ¥MySQL
mysql -u root -p
```

### ç”Ÿäº§ç¯å¢ƒè¿æ¥é…ç½®

å¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œæ¨èä½¿ç”¨ä¸“ç”¨æ•°æ®åº“ç”¨æˆ·ï¼š

```sql
-- åˆ›å»ºä¸“ç”¨æ•°æ®åº“ç”¨æˆ·
CREATE USER 'bot_user'@'%' IDENTIFIED BY 'secure_password';
GRANT ALL PRIVILEGES ON bot.* TO 'bot_user'@'%';
FLUSH PRIVILEGES;
```

### è¿æ¥å‚æ•°è¯´æ˜

| å‚æ•° | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|------|------|--------|
| ç”¨æˆ·å | æ•°æ®åº“è®¿é—®ç”¨æˆ·å | root |
| å¯†ç  | æ•°æ®åº“è®¿é—®å¯†ç  | your_password |
| ä¸»æœºåœ°å€ | MySQLæœåŠ¡å™¨åœ°å€ | localhost |
| ç«¯å£ | MySQLæœåŠ¡ç«¯å£ | 3306 |

**ç« èŠ‚æ¥æº**
- [Life_Deployment_Guide.md](file://Life_Deployment_Guide.md#L17-L19)

## æ•°æ®åº“åˆ›å»ºä¸å­—ç¬¦é›†è®¾ç½®

### CREATE DATABASE IF NOT EXISTSè¯­å¥

è¿™æ˜¯æ•°æ®åº“åˆå§‹åŒ–çš„æ ¸å¿ƒè¯­å¥ï¼Œå…·æœ‰ä»¥ä¸‹é‡è¦ç‰¹æ€§ï¼š

```sql
CREATE DATABASE IF NOT EXISTS bot DEFAULT CHARSET utf8mb4;
```

#### è¯­å¥è§£æ

- **IF NOT EXISTS**ï¼šé˜²æ­¢é‡å¤åˆ›å»ºå¯¼è‡´é”™è¯¯
- **DEFAULT CHARSET utf8mb4**ï¼šè®¾ç½®æ•°æ®åº“é»˜è®¤å­—ç¬¦é›†
- **bot**ï¼šæŒ‡å®šæ•°æ®åº“åç§°

#### å­—ç¬¦é›†é€‰æ‹©çš„é‡è¦æ€§

**utf8mb4å­—ç¬¦é›†çš„ä¼˜åŠ¿**ï¼š
- æ”¯æŒå®Œæ•´çš„Unicodeå­—ç¬¦é›†
- åŒ…å«è¡¨æƒ…ç¬¦å·(Emoji)æ”¯æŒ
- å…¼å®¹å›½é™…åŒ–çš„æ–‡æœ¬å†…å®¹
- é¿å…ä¸­æ–‡ä¹±ç é—®é¢˜

#### å­—ç¬¦é›†é…ç½®å¯¹æ¯”

| å­—ç¬¦é›† | å­˜å‚¨ç©ºé—´ | æ”¯æŒå­—ç¬¦èŒƒå›´ | é€‚ç”¨åœºæ™¯ |
|--------|----------|--------------|----------|
| latin1 | 1å­—èŠ‚ | ASCIIå­—ç¬¦ | è‹±æ–‡ç½‘ç«™ |
| utf8 | 3å­—èŠ‚ | åŸºæœ¬å¤šè¯­è¨€ | ç®€å•å›½é™…åŒ– |
| utf8mb4 | 4å­—èŠ‚ | å®Œæ•´Unicode | ç°ä»£Webåº”ç”¨ |

### USEè¯­å¥çš„ä½œç”¨

```sql
USE bot;
```

**USEè¯­å¥çš„å¿…è¦æ€§**ï¼š
1. **ä¸Šä¸‹æ–‡åˆ‡æ¢**ï¼šæ˜ç¡®æŒ‡å®šæ“ä½œçš„ç›®æ ‡æ•°æ®åº“
2. **é¿å…æ­§ä¹‰**ï¼šé˜²æ­¢åœ¨å¤šä¸ªæ•°æ®åº“é—´è¯¯æ“ä½œ
3. **æ€§èƒ½ä¼˜åŒ–**ï¼šå‡å°‘æ•°æ®åº“æŸ¥æ‰¾å¼€é”€
4. **æƒé™ç®¡ç†**ï¼šç¡®ä¿ç”¨æˆ·åªèƒ½è®¿é—®æˆæƒçš„æ•°æ®åº“

```mermaid
sequenceDiagram
participant User as "ç”¨æˆ·"
participant MySQL as "MySQLæœåŠ¡å™¨"
participant DB as "botæ•°æ®åº“"
User->>MySQL : è¿æ¥æœåŠ¡å™¨
MySQL-->>User : è¿æ¥æˆåŠŸ
User->>MySQL : CREATE DATABASE IF NOT EXISTS bot
MySQL-->>User : æ•°æ®åº“åˆ›å»ºå®Œæˆ
User->>MySQL : USE bot
MySQL-->>User : åˆ‡æ¢åˆ°botæ•°æ®åº“
User->>MySQL : æ‰§è¡Œåç»­SQLè¯­å¥
MySQL->>DB : åœ¨botæ•°æ®åº“ä¸­æ‰§è¡Œ
DB-->>MySQL : è¿”å›æ‰§è¡Œç»“æœ
MySQL-->>User : æ“ä½œå®Œæˆ
```

**å›¾è¡¨æ¥æº**
- [Life_Deployment_Guide.md](file://Life_Deployment_Guide.md#L20-L22)

**ç« èŠ‚æ¥æº**
- [Life_Deployment_Guide.md](file://Life_Deployment_Guide.md#L20-L22)

## SQLè„šæœ¬æ‰§è¡Œæµç¨‹

### sourceå‘½ä»¤æ‰§è¡Œ

```sql
source Life_Database_Init.sql;
```

#### sourceå‘½ä»¤ç‰¹ç‚¹

- **æ‰¹å¤„ç†æ‰§è¡Œ**ï¼šä¸€æ¬¡æ€§æ‰§è¡Œæ•´ä¸ªè„šæœ¬æ–‡ä»¶
- **é”™è¯¯å¤„ç†**ï¼šé‡åˆ°é”™è¯¯æ—¶åœæ­¢æ‰§è¡Œ
- **è¿›åº¦è·Ÿè¸ª**ï¼šæ˜¾ç¤ºæ‰§è¡Œè¿›åº¦ä¿¡æ¯
- **èµ„æºç®¡ç†**ï¼šè‡ªåŠ¨ç®¡ç†æ•°æ®åº“è¿æ¥

#### æ‰§è¡Œå‰å‡†å¤‡

```sql
-- æ£€æŸ¥MySQLç‰ˆæœ¬å…¼å®¹æ€§
SELECT VERSION();

-- æ£€æŸ¥å­—ç¬¦é›†è®¾ç½®
SHOW VARIABLES LIKE 'character_set_database';
SHOW VARIABLES LIKE 'collation_database';
```

#### æ‰§è¡Œç›‘æ§

```sql
-- ç›‘æ§æ‰§è¡ŒçŠ¶æ€
SHOW PROCESSLIST;

-- æ£€æŸ¥æ‰§è¡Œæ—¶é—´
SET @start_time = NOW();
-- æ‰§è¡Œè„šæœ¬
SELECT TIMEDIFF(NOW(), @start_time) AS execution_time;
```

### æ‰¹é‡æ‰§è¡Œæ›¿ä»£æ–¹æ¡ˆ

å¯¹äºè‡ªåŠ¨åŒ–éƒ¨ç½²ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œæ‰¹é‡æ‰§è¡Œï¼š

```bash
# Linux/MacOS
mysql -u root -p bot < Life_Database_Init.sql

# Windows
mysql -u root -p bot < Life_Database_Init.sql
```

**ç« èŠ‚æ¥æº**
- [Life_Deployment_Guide.md](file://Life_Deployment_Guide.md#L24)

## è¡¨ç»“æ„åˆ†æ

### æ ¸å¿ƒä¸šåŠ¡è¡¨æ¶æ„

æµ®ç”Ÿå·æ¨¡å—åŒ…å«22ä¸ªæ ¸å¿ƒä¸šåŠ¡è¡¨ï¼ŒæŒ‰åŠŸèƒ½åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªç±»åˆ«ï¼š

```mermaid
erDiagram
LIFE_PLAYER {
bigint id PK
varchar user_id UK
varchar nickname UK
tinyint attribute
int level
bigint experience
bigint cultivation
int cultivation_speed
datetime last_cultivation_time
int health
int max_health
int defense
decimal critical_rate
decimal critical_damage
int stamina
bigint spirit
bigint current_map_id
tinyint game_status
datetime create_time
datetime update_time
}
LIFE_EQUIPMENT {
bigint id PK
varchar name
tinyint type
tinyint attribute
tinyint rarity
text description
datetime create_time
}
LIFE_SKILL {
bigint id PK
varchar name
tinyint type
tinyint attribute
int power
int cooldown
int required_level
int required_cultivation
int max_level
text description
}
LIFE_MONSTER {
bigint id PK
varchar name
bigint map_id FK
tinyint monster_type
tinyint attribute
int level
int health
int attack_power
int defense
int speed
decimal critical_rate
decimal critical_damage
decimal armor_break
datetime create_time
}
LIFE_ITEM {
bigint id PK
varchar name
tinyint type
int effect_value
varchar effect_attribute
bigint skill_id FK
int max_use_count
tinyint can_use_in_battle
text description
datetime create_time
}
LIFE_MAP {
bigint id PK
varchar name
tinyint type
int min_level
text description
datetime create_time
}
LIFE_PLAYER ||--o{ LIFE_PLAYER_EQUIPMENT : "è£…å¤‡"
LIFE_PLAYER ||--o{ LIFE_PLAYER_ITEM : "é“å…·"
LIFE_PLAYER ||--o{ LIFE_PLAYER_SKILL : "æŠ€èƒ½"
LIFE_PLAYER ||--o{ LIFE_PLAYER_ACHIEVEMENT : "æˆå°±"
LIFE_PLAYER ||--o{ LIFE_PLAYER_SIGNIN : "ç­¾åˆ°"
LIFE_PLAYER ||--o{ LIFE_GAME_STATUS : "æ¸¸æˆçŠ¶æ€"
LIFE_PLAYER ||--o{ LIFE_BATTLE_STATE : "æˆ˜æ–—çŠ¶æ€"
LIFE_PLAYER ||--o{ LIFE_TEAM_MEMBER : "é˜Ÿä¼æˆå‘˜"
LIFE_PLAYER ||--o{ LIFE_MAIL : "é‚®ä»¶"
LIFE_PLAYER ||--o{ LIFE_WORLD_BOSS_CHALLENGE : "ä¸–ç•ŒBOSSæŒ‘æˆ˜"
LIFE_EQUIPMENT ||--o{ LIFE_PLAYER_EQUIPMENT : "ç©å®¶è£…å¤‡"
LIFE_SKILL ||--o{ LIFE_PLAYER_SKILL : "ç©å®¶æŠ€èƒ½"
LIFE_ITEM ||--o{ LIFE_PLAYER_ITEM : "ç©å®¶é“å…·"
LIFE_MONSTER ||--o{ LIFE_MONSTER_DROP : "æ€ªç‰©æ‰è½"
LIFE_MONSTER ||--o{ LIFE_MONSTER_SKILL : "æ€ªç‰©æŠ€èƒ½"
LIFE_MAP ||--o{ LIFE_MONSTER : "æ€ªç‰©åˆ†å¸ƒ"
LIFE_MAP ||--o{ LIFE_NPC : "NPCä½ç½®"
LIFE_MAP ||--o{ LIFE_DUNGEON : "å‰¯æœ¬åœ°å›¾"
LIFE_MAP ||--o{ LIFE_SHOP : "å•†åº—ä½ç½®"
```

**å›¾è¡¨æ¥æº**
- [Life_Database_Init.sql](file://Life_Database_Init.sql#L6-L48)
- [Life_Database_Init.sql](file://Life_Database_Init.sql#L51-L74)
- [Life_Database_Init.sql](file://Life_Database_Init.sql#L89-L115)
- [Life_Database_Init.sql](file://Life_Database_Init.sql#L117-L138)
- [Life_Database_Init.sql](file://Life_Database_Init.sql#L140-L176)
- [Life_Database_Init.sql](file://Life_Database_Init.sql#L187-L201)

### è¡¨åˆ›å»ºé¡ºåºä¸ä¾èµ–å…³ç³»

#### ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ•°æ®è¡¨

1. **ç©å®¶è§’è‰²è¡¨ (life_player)** - æ ¸å¿ƒå®ä½“è¡¨
2. **è£…å¤‡åŸºç¡€è¡¨ (life_equipment)** - è£…å¤‡ç³»ç»ŸåŸºç¡€
3. **æŠ€èƒ½åŸºç¡€è¡¨ (life_skill)** - æŠ€èƒ½ç³»ç»ŸåŸºç¡€
4. **åœ°å›¾è¡¨ (life_map)** - åœ°å›¾ç³»ç»ŸåŸºç¡€
5. **æ€ªç‰©è¡¨ (life_monster)** - æ€ªç‰©ç³»ç»ŸåŸºç¡€
6. **é“å…·è¡¨ (life_item)** - é“å…·ç³»ç»ŸåŸºç¡€

#### ç¬¬äºŒé˜¶æ®µï¼šå…³è”å…³ç³»è¡¨

7. **ç©å®¶è£…å¤‡è¡¨ (life_player_equipment)** - ç©å®¶ä¸è£…å¤‡å…³è”
8. **ç©å®¶é“å…·è¡¨ (life_player_item)** - ç©å®¶ä¸é“å…·å…³è”
9. **ç©å®¶æŠ€èƒ½è¡¨ (life_player_skill)** - ç©å®¶ä¸æŠ€èƒ½å…³è”
10. **æ€ªç‰©æ‰è½é…ç½®è¡¨ (life_monster_drop)** - æ€ªç‰©æ‰è½è§„åˆ™
11. **æ€ªç‰©æŠ€èƒ½è¡¨ (life_monster_skill)** - æ€ªç‰©æŠ€èƒ½å…³è”

#### ç¬¬ä¸‰é˜¶æ®µï¼šé«˜çº§åŠŸèƒ½è¡¨

12. **æˆå°±è¡¨ (life_achievement)** - æˆå°±ç³»ç»Ÿ
13. **å¥½å‹è¡¨ (life_friend)** - å¥½å‹ç³»ç»Ÿ
14. **é‚®ä»¶è¡¨ (life_mail)** - é‚®ä»¶ç³»ç»Ÿ
15. **ä¸–ç•ŒBOSSè¡¨ (life_world_boss)** - BOSSç³»ç»Ÿ
16. **å‰¯æœ¬è¡¨ (life_dungeon)** - å‰¯æœ¬ç³»ç»Ÿ
17. **å•†åº—è¡¨ (life_shop)** - å•†åº—ç³»ç»Ÿ
18. **é˜Ÿä¼è¡¨ (life_team)** - ç»„é˜Ÿç³»ç»Ÿ
19. **ç­¾åˆ°è®°å½•è¡¨ (life_player_signin)** - ç­¾åˆ°ç³»ç»Ÿ
20. **æˆ˜æ–—çŠ¶æ€è¡¨ (life_battle_state)** - æˆ˜æ–—çŠ¶æ€
21. **å¢ƒç•Œé…ç½®è¡¨ (life_realm_config)** - å¢ƒç•Œç³»ç»Ÿ
22. **ç³»ç»Ÿé…ç½®è¡¨ (life_system_config)** - ç³»ç»Ÿé…ç½®

### ç´¢å¼•è®¾è®¡åŸåˆ™

#### ä¸»é”®ç´¢å¼•
- æ‰€æœ‰è¡¨éƒ½å®šä¹‰äº†è‡ªå¢ä¸»é”®
- æä¾›å”¯ä¸€æ ‡è¯†ç¬¦ä¿è¯æ•°æ®å®Œæ•´æ€§

#### å¤–é”®ç´¢å¼•
- åœ¨å…³è”å­—æ®µä¸Šå»ºç«‹ç´¢å¼•
- æ”¯æŒé«˜æ•ˆçš„å…³è”æŸ¥è¯¢
- ç»´æŠ¤æ•°æ®ä¸€è‡´æ€§

#### å”¯ä¸€çº¦æŸ
- ç”¨æˆ·IDå”¯ä¸€æ€§ (user_id)
- è§’è‰²æ˜µç§°å”¯ä¸€æ€§ (nickname)
- ç©å®¶æŠ€èƒ½ç»„åˆå”¯ä¸€æ€§ (player_id, skill_id)

**ç« èŠ‚æ¥æº**
- [Life_Database_Init.sql](file://Life_Database_Init.sql#L1-L646)

## åˆå§‹åŒ–è„šæœ¬è¯¦è§£

### æ•°æ®åº“ç»“æ„å®šä¹‰

#### ç©å®¶è§’è‰²è¡¨ (life_player)

ç©å®¶è§’è‰²è¡¨æ˜¯æ•´ä¸ªæ¸¸æˆç³»ç»Ÿçš„æ ¸å¿ƒå®ä½“ï¼ŒåŒ…å«ä¿®ä»™è€…çš„æ‰€æœ‰åŸºæœ¬ä¿¡æ¯ï¼š

```sql
CREATE TABLE IF NOT EXISTS `life_player` (
    `id` bigint NOT NULL AUTO_INCREMENT,
    `user_id` varchar(50) NOT NULL COMMENT 'ç”¨æˆ·ID',
    `nickname` varchar(21) NOT NULL COMMENT 'è§’è‰²æ˜µç§°',
    `attribute` tinyint NOT NULL COMMENT 'è§’è‰²å±æ€§',
    `level` int DEFAULT 1 COMMENT 'ç­‰çº§',
    `experience` bigint DEFAULT 0 COMMENT 'ç»éªŒå€¼',
    `cultivation` bigint DEFAULT 0 COMMENT 'ä¿®ä¸º',
    `cultivation_speed` int DEFAULT 10 COMMENT 'ä¿®ç‚¼é€Ÿåº¦',
    `last_cultivation_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT 'æœ€åä¿®ç‚¼æ—¶é—´',
    -- ... æ›´å¤šå­—æ®µ
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_user_id` (`user_id`),
    UNIQUE KEY `uk_nickname` (`nickname`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç©å®¶è§’è‰²è¡¨';
```

#### å…³é”®å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | é»˜è®¤å€¼ |
|--------|------|------|--------|
| user_id | varchar(50) | ç”¨æˆ·å”¯ä¸€æ ‡è¯† | å¿…å¡« |
| nickname | varchar(21) | è§’è‰²æ˜µç§° | å¿…å¡« |
| attribute | tinyint | äº”è¡Œå±æ€§(1-5) | å¿…å¡« |
| level | int | å½“å‰ç­‰çº§ | 1 |
| experience | bigint | å½“å‰ç»éªŒ | 0 |
| cultivation | bigint | ä¿®ä¸ºå€¼ | 0 |
| spirit | bigint | çµç²¹æ•°é‡ | 1000 |

### åˆå§‹æ•°æ®æ’å…¥

#### åœ°å›¾æ•°æ®åˆå§‹åŒ–

```sql
INSERT INTO `life_map` (`id`, `name`, `type`, `min_level`, `description`) VALUES
(1, 'æ–°æ‰‹æ‘', 1, 1, 'ä¿®ä»™è€…çš„èµ·å§‹ä¹‹åœ°'),
(2, 'é’äº‘å±±', 1, 10, 'çµæ°”å……æ²›çš„ä¿®ç‚¼åœ£åœ°'),
(3, 'å¹½å†¥è°·', 1, 20, 'é˜´æ°”æ£®æ£®çš„å±é™©ä¹‹åœ°');
```

#### æ€ªç‰©æ•°æ®åˆå§‹åŒ–

```sql
INSERT INTO `life_monster` (`id`, `name`, `map_id`, `monster_type`, `attribute`, `level`, `health`, `attack_power`, `defense`, `speed`) VALUES
(1, 'é‡ç‹¼', 1, 1, 0, 1, 50, 15, 5, 8),
(2, 'å±±è´¼', 1, 1, 0, 2, 80, 20, 8, 10);
```

#### æŠ€èƒ½æ•°æ®åˆå§‹åŒ–

```sql
INSERT INTO `life_skill` (`id`, `name`, `type`, `attribute`, `power`, `cooldown`, `required_level`, `max_level`, `description`) VALUES
(1, 'é‡‘å…ƒæ–©', 1, 1, 120, 3, 1, 10, 'é‡‘å±æ€§åŸºç¡€æ”»å‡»æŠ€èƒ½'),
(2, 'æœ¨çµæœ¯', 1, 2, 110, 3, 1, 10, 'æœ¨å±æ€§åŸºç¡€æ”»å‡»æŠ€èƒ½');
```

### ç³»ç»Ÿé…ç½®æ•°æ®

#### æ ¸å¿ƒç®—æ³•é…ç½®

```sql
INSERT INTO `life_system_config` (`config_key`, `config_value`, `description`) VALUES
('speed_armor_break_rate', '0.005', 'æ¯ç‚¹é€Ÿåº¦å¢åŠ çš„ç ´é˜²ç‡'),
('constitution_health_rate', '10', 'æ¯ç‚¹ä½“è´¨å¢åŠ çš„è¡€é‡'),
('spirit_critical_rate', '0.01', 'æ¯ç‚¹çµåŠ›å¢åŠ çš„ä¼šå¿ƒç‡'),
('strength_attack_rate', '6', 'æ¯ç‚¹åŠ›é‡å¢åŠ çš„æ”»å‡»åŠ›');
```

#### é…ç½®é¡¹åˆ†ç±»

| é…ç½®ç±»åˆ« | é…ç½®é¡¹ | é»˜è®¤å€¼ | ä½œç”¨ |
|----------|--------|--------|------|
| å±æ€§è®¡ç®— | speed_armor_break_rate | 0.005 | é€Ÿåº¦å¯¹ç ´é˜²çš„å½±å“ |
| å±æ€§è®¡ç®— | constitution_health_rate | 10 | ä½“è´¨å¯¹è¡€é‡çš„å½±å“ |
| æˆ˜æ–—ç³»ç»Ÿ | spirit_critical_rate | 0.01 | çµåŠ›å¯¹ä¼šå¿ƒç‡çš„å½±å“ |
| æˆ˜æ–—ç³»ç»Ÿ | strength_attack_rate | 6 | åŠ›é‡å¯¹æ”»å‡»åŠ›çš„å½±å“ |
| æ¸¸æˆæœºåˆ¶ | stamina_recover_interval | 5 | ä½“åŠ›æ¢å¤é—´éš”(åˆ†é’Ÿ) |

**ç« èŠ‚æ¥æº**
- [Life_Database_Init.sql](file://Life_Database_Init.sql#L393-L646)

## è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬

### Shellè„šæœ¬ç¤ºä¾‹

#### Linux/MacOSè„šæœ¬

```bash
#!/bin/bash
# æµ®ç”Ÿå·æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬

set -e

echo "å¼€å§‹æµ®ç”Ÿå·æ•°æ®åº“åˆå§‹åŒ–..."

# é…ç½®å˜é‡
MYSQL_USER="root"
MYSQL_PASSWORD="your_password"
DATABASE_NAME="bot"
INIT_SCRIPT="Life_Database_Init.sql"

# æ£€æŸ¥MySQLå®¢æˆ·ç«¯
if ! command -v mysql &> /dev/null; then
    echo "é”™è¯¯ï¼šæœªæ‰¾åˆ°MySQLå®¢æˆ·ç«¯"
    exit 1
fi

# åˆ›å»ºæ•°æ®åº“
echo "åˆ›å»ºæ•°æ®åº“ $DATABASE_NAME..."
mysql -u $MYSQL_USER -p$MYSQL_PASSWORD -e "
CREATE DATABASE IF NOT EXISTS $DATABASE_NAME DEFAULT CHARSET utf8mb4;
USE $DATABASE_NAME;
SOURCE $INIT_SCRIPT;
"

# éªŒè¯è¡¨åˆ›å»º
echo "éªŒè¯è¡¨åˆ›å»º..."
TABLE_COUNT=$(mysql -u $MYSQL_USER -p$MYSQL_PASSWORD -D $DATABASE_NAME -N -e "
SHOW TABLES LIKE 'life_%';
SELECT COUNT(*) FROM information_schema.tables WHERE table_schema='$DATABASE_NAME' AND table_name LIKE 'life_%';
")

if [ "$TABLE_COUNT" -ge 22 ]; then
    echo "âœ… æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸï¼Œå…±åˆ›å»º $TABLE_COUNT å¼ è¡¨"
else
    echo "âŒ æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥ï¼Œæ£€æµ‹åˆ° $TABLE_COUNT å¼ è¡¨"
    exit 1
fi

# æ’å…¥åˆå§‹æ•°æ®
echo "æ’å…¥åˆå§‹æ•°æ®..."
mysql -u $MYSQL_USER -p$MYSQL_PASSWORD -D $DATABASE_NAME -e "
-- éªŒè¯æ•°æ®æ’å…¥
SELECT COUNT(*) as player_count FROM life_player;
SELECT COUNT(*) as map_count FROM life_map;
SELECT COUNT(*) as monster_count FROM life_monster;
"

echo "ğŸ‰ æµ®ç”Ÿå·æ•°æ®åº“åˆå§‹åŒ–å®Œæˆï¼"
```

#### Windowsæ‰¹å¤„ç†è„šæœ¬

```batch
@echo off
REM æµ®ç”Ÿå·æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬

set MYSQL_USER=root
set MYSQL_PASSWORD=your_password
set DATABASE_NAME=bot
set INIT_SCRIPT=Life_Database_Init.sql

echo å¼€å§‹æµ®ç”Ÿå·æ•°æ®åº“åˆå§‹åŒ–...

REM æ£€æŸ¥MySQLå®¢æˆ·ç«¯
where mysql >nul 2>nul
if %ERRORLEVEL% neq 0 (
    echo é”™è¯¯ï¼šæœªæ‰¾åˆ°MySQLå®¢æˆ·ç«¯
    pause
    exit /b 1
)

REM åˆ›å»ºæ•°æ®åº“å¹¶æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬
echo åˆ›å»ºæ•°æ®åº“ %DATABASE_NAME%...
mysql -u %MYSQL_USER% -p%MYSQL_PASSWORD% -e ^
"CREATE DATABASE IF NOT EXISTS %DATABASE_NAME% DEFAULT CHARSET utf8mb4;^
USE %DATABASE_NAME%;^
SOURCE %INIT_SCRIPT%;"

REM éªŒè¯è¡¨åˆ›å»º
echo éªŒè¯è¡¨åˆ›å»º...
FOR /F "tokens=*" %%i IN ('mysql -u %MYSQL_USER% -p%MYSQL_PASSWORD% -D %DATABASE_NAME% -N -e "SHOW TABLES LIKE 'life_%'; SELECT COUNT(*) FROM information_schema.tables WHERE table_schema='%DATABASE_NAME%' AND table_name LIKE 'life_%';"') DO (
    set RESULT=%%i
)

echo ç»“æœï¼š%RESULT%

if %RESULT% geq 22 (
    echo âœ… æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸ
) else (
    echo âŒ æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥
    pause
    exit /b 1
)

echo ğŸ‰ æµ®ç”Ÿå·æ•°æ®åº“åˆå§‹åŒ–å®Œæˆï¼
pause
```

### Pythonè‡ªåŠ¨åŒ–è„šæœ¬

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
æµ®ç”Ÿå·æ•°æ®åº“åˆå§‹åŒ–è‡ªåŠ¨åŒ–è„šæœ¬
"""

import subprocess
import sys
import os
import time
from typing import Dict, List, Optional

class DatabaseInitializer:
    def __init__(self):
        self.config = {
            'mysql_user': 'root',
            'mysql_password': 'your_password',
            'database_name': 'bot',
            'init_script': 'Life_Database_Init.sql',
            'expected_tables': 22
        }
        
    def check_mysql_client(self) -> bool:
        """æ£€æŸ¥MySQLå®¢æˆ·ç«¯æ˜¯å¦å¯ç”¨"""
        try:
            subprocess.run(['mysql', '--version'], 
                          capture_output=True, 
                          timeout=5)
            return True
        except (subprocess.TimeoutExpired, FileNotFoundError):
            print("é”™è¯¯ï¼šæœªæ‰¾åˆ°MySQLå®¢æˆ·ç«¯")
            return False
            
    def create_database(self) -> bool:
        """åˆ›å»ºæ•°æ®åº“"""
        try:
            cmd = [
                'mysql', '-u', self.config['mysql_user'],
                f'-p{self.config["mysql_password"]}',
                '-e',
                f'CREATE DATABASE IF NOT EXISTS {self.config["database_name"]} DEFAULT CHARSET utf8mb4;'
            ]
            
            result = subprocess.run(cmd, capture_output=True, text=True, timeout=30)
            
            if result.returncode == 0:
                print(f"âœ… æ•°æ®åº“ {self.config['database_name']} åˆ›å»ºæˆåŠŸ")
                return True
            else:
                print(f"âŒ æ•°æ®åº“åˆ›å»ºå¤±è´¥: {result.stderr}")
                return False
                
        except subprocess.TimeoutExpired:
            print("âŒ æ•°æ®åº“åˆ›å»ºè¶…æ—¶")
            return False
            
    def execute_init_script(self) -> bool:
        """æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬"""
        try:
            # åˆ‡æ¢åˆ°è„šæœ¬æ‰€åœ¨ç›®å½•
            script_dir = os.path.dirname(os.path.abspath(__file__))
            init_script_path = os.path.join(script_dir, self.config['init_script'])
            
            if not os.path.exists(init_script_path):
                print(f"âŒ åˆå§‹åŒ–è„šæœ¬ä¸å­˜åœ¨: {init_script_path}")
                return False
                
            cmd = [
                'mysql', '-u', self.config['mysql_user'],
                f'-p{self.config["mysql_password"]}',
                self.config['database_name'],
                '<', init_script_path
            ]
            
            result = subprocess.run(' '.join(cmd), shell=True, 
                                  capture_output=True, text=True, timeout=120)
            
            if result.returncode == 0:
                print("âœ… åˆå§‹åŒ–è„šæœ¬æ‰§è¡ŒæˆåŠŸ")
                return True
            else:
                print(f"âŒ åˆå§‹åŒ–è„šæœ¬æ‰§è¡Œå¤±è´¥: {result.stderr}")
                return False
                
        except subprocess.TimeoutExpired:
            print("âŒ åˆå§‹åŒ–è„šæœ¬æ‰§è¡Œè¶…æ—¶")
            return False
            
    def verify_tables(self) -> int:
        """éªŒè¯è¡¨åˆ›å»ºæ•°é‡"""
        try:
            cmd = [
                'mysql', '-u', self.config['mysql_user'],
                f'-p{self.config["mysql_password"]}',
                '-D', self.config['database_name'],
                '-N', '-e',
                "SELECT COUNT(*) FROM information_schema.tables WHERE table_schema='{}' AND table_name LIKE 'life_%';".format(
                    self.config['database_name']
                )
            ]
            
            result = subprocess.run(cmd, capture_output=True, text=True, timeout=10)
            
            if result.returncode == 0:
                count = int(result.stdout.strip())
                print(f"âœ… æ£€æµ‹åˆ° {count} å¼ life_*è¡¨")
                return count
            else:
                print(f"âŒ è¡¨éªŒè¯å¤±è´¥: {result.stderr}")
                return 0
                
        except subprocess.TimeoutExpired:
            print("âŒ è¡¨éªŒè¯è¶…æ—¶")
            return 0
            
    def run(self) -> bool:
        """è¿è¡Œå®Œæ•´åˆå§‹åŒ–æµç¨‹"""
        print("=" * 50)
        print("æµ®ç”Ÿå·æ•°æ®åº“åˆå§‹åŒ–ç¨‹åº")
        print("=" * 50)
        
        # æ­¥éª¤1: æ£€æŸ¥MySQLå®¢æˆ·ç«¯
        print("\n1. æ£€æŸ¥MySQLå®¢æˆ·ç«¯...")
        if not self.check_mysql_client():
            return False
            
        # æ­¥éª¤2: åˆ›å»ºæ•°æ®åº“
        print("\n2. åˆ›å»ºæ•°æ®åº“...")
        if not self.create_database():
            return False
            
        # æ­¥éª¤3: æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬
        print("\n3. æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬...")
        if not self.execute_init_script():
            return False
            
        # æ­¥éª¤4: éªŒè¯è¡¨åˆ›å»º
        print("\n4. éªŒè¯è¡¨åˆ›å»º...")
        table_count = self.verify_tables()
        
        if table_count >= self.config['expected_tables']:
            print(f"\nğŸ‰ æ•°æ®åº“åˆå§‹åŒ–å®Œæˆï¼å…±åˆ›å»º {table_count} å¼ è¡¨")
            return True
        else:
            print(f"\nâŒ æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥ï¼ŒæœŸæœ›è‡³å°‘ {self.config['expected_tables']} å¼ è¡¨ï¼Œå®é™…åˆ›å»º {table_count} å¼ ")
            return False

if __name__ == "__main__":
    initializer = DatabaseInitializer()
    success = initializer.run()
    sys.exit(0 if success else 1)
```

### Dockeréƒ¨ç½²è„šæœ¬

```dockerfile
# Dockerfile for automated database initialization
FROM mysql:8.0

# è®¾ç½®ç¯å¢ƒå˜é‡
ENV MYSQL_ROOT_PASSWORD=your_root_password
ENV MYSQL_DATABASE=bot
ENV MYSQL_USER=bot_user
ENV MYSQL_PASSWORD=bot_password

# å¤åˆ¶åˆå§‹åŒ–è„šæœ¬
COPY Life_Database_Init.sql /docker-entrypoint-initdb.d/

# è®¾ç½®å­—ç¬¦é›†
RUN echo "[mysqld]" >> /etc/mysql/conf.d/custom.cnf && \
    echo "character-set-server=utf8mb4" >> /etc/mysql/conf.d/custom.cnf && \
    echo "collation-server=utf8mb4_unicode_ci" >> /etc/mysql/conf.d/custom.cnf

EXPOSE 3306
```

```yaml
# docker-compose.yml
version: '3.8'

services:
  mysql:
    image: mysql:8.0
    container_name: bot_mysql
    environment:
      MYSQL_ROOT_PASSWORD: your_root_password
      MYSQL_DATABASE: bot
      MYSQL_USER: bot_user
      MYSQL_PASSWORD: bot_password
    ports:
      - "3306:3306"
    volumes:
      - ./data:/var/lib/mysql
      - ./Life_Database_Init.sql:/docker-entrypoint-initdb.d/Life_Database_Init.sql
    command: --default-authentication-plugin=mysql_native_password
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost"]
      interval: 30s
      timeout: 10s
      retries: 3
```

**ç« èŠ‚æ¥æº**
- [Life_Deployment_Guide.md](file://Life_Deployment_Guide.md#L12-L26)

## æ•…éšœæ’é™¤æŒ‡å—

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 1. MySQLè¿æ¥é—®é¢˜

**é—®é¢˜ç—‡çŠ¶**ï¼š
```
ERROR 2003 (HY000): Can't connect to MySQL server on 'localhost' (10061)
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥MySQLæœåŠ¡çŠ¶æ€
sudo systemctl status mysql
# å¯åŠ¨MySQLæœåŠ¡
sudo systemctl start mysql
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep 3306
```

#### 2. å­—ç¬¦é›†ç¼–ç é—®é¢˜

**é—®é¢˜ç—‡çŠ¶**ï¼š
```
ERROR 1300 (HY000): Invalid utf8 character string
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```sql
-- æ£€æŸ¥å½“å‰å­—ç¬¦é›†è®¾ç½®
SHOW VARIABLES LIKE 'character_set%';
SHOW VARIABLES LIKE 'collation%';

-- ä¿®æ”¹æ•°æ®åº“å­—ç¬¦é›†
ALTER DATABASE bot CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci;
```

#### 3. æƒé™ä¸è¶³é—®é¢˜

**é—®é¢˜ç—‡çŠ¶**ï¼š
```
ERROR 1044 (42000): Access denied for user
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```sql
-- æˆäºˆæ•°æ®åº“æƒé™
GRANT ALL PRIVILEGES ON bot.* TO 'username'@'%' IDENTIFIED BY 'password';
FLUSH PRIVILEGES;

-- æ£€æŸ¥æƒé™
SHOW GRANTS FOR 'username'@'%';
```

#### 4. è„šæœ¬æ‰§è¡Œä¸­æ–­

**é—®é¢˜ç—‡çŠ¶**ï¼š
```
ERROR 1050 (42S01): Table already exists
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```sql
-- æ£€æŸ¥è¡¨æ˜¯å¦å­˜åœ¨
SHOW TABLES LIKE 'life_%';

-- åˆ é™¤ç°æœ‰è¡¨ï¼ˆè°¨æ…æ“ä½œï¼‰
DROP TABLE IF EXISTS life_player;
-- é‡æ–°æ‰§è¡Œè„šæœ¬
```

### è°ƒè¯•å·¥å…·å’ŒæŠ€å·§

#### æ—¥å¿—åˆ†æ

```sql
-- å¯ç”¨æ…¢æŸ¥è¯¢æ—¥å¿—
SET GLOBAL slow_query_log = 'ON';
SET GLOBAL long_query_time = 1;

-- æŸ¥çœ‹é”™è¯¯æ—¥å¿—
SHOW VARIABLES LIKE 'log_error';
```

#### æ€§èƒ½ç›‘æ§

```sql
-- ç›‘æ§è¡¨å¤§å°
SELECT 
    table_name,
    ROUND(((data_length + index_length) / 1024 / 1024), 2) AS 'Size in MB'
FROM information_schema.TABLES 
WHERE table_schema = 'bot'
ORDER BY (data_length + index_length) DESC;

-- ç›‘æ§ç´¢å¼•ä½¿ç”¨
SELECT 
    table_name, 
    index_name, 
    last_used
FROM performance_schema.table_io_waits_summary_by_index_usage 
WHERE object_schema = 'bot';
```

#### æ•°æ®å®Œæ•´æ€§æ£€æŸ¥

```sql
-- æ£€æŸ¥å¤–é”®çº¦æŸ
SELECT 
    CONSTRAINT_NAME, 
    TABLE_NAME, 
    REFERENCED_TABLE_NAME
FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE 
WHERE CONSTRAINT_SCHEMA = 'bot' 
AND REFERENCED_TABLE_NAME IS NOT NULL;

-- æ£€æŸ¥æ•°æ®ä¸€è‡´æ€§
SELECT 
    COUNT(*) as total_records,
    SUM(CASE WHEN user_id IS NULL THEN 1 ELSE 0 END) as null_user_id,
    SUM(CASE WHEN nickname IS NULL THEN 1 ELSE 0 END) as null_nickname
FROM life_player;
```

**ç« èŠ‚æ¥æº**
- [Life_Deployment_Guide.md](file://Life_Deployment_Guide.md#L129-L143)

## æœ€ä½³å®è·µå»ºè®®

### æ•°æ®åº“è®¾è®¡åŸåˆ™

#### 1. å­—ç¬¦é›†ç»Ÿä¸€

```sql
-- åœ¨æ‰€æœ‰è¡¨ä¸­å¼ºåˆ¶ä½¿ç”¨utf8mb4
ALTER TABLE life_player CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

#### 2. ç´¢å¼•ä¼˜åŒ–

```sql
-- ä¸ºé¢‘ç¹æŸ¥è¯¢çš„å­—æ®µæ·»åŠ ç´¢å¼•
CREATE INDEX idx_player_user_id ON life_player(user_id);
CREATE INDEX idx_player_nickname ON life_player(nickname);

-- ä¸ºå…³è”æŸ¥è¯¢æ·»åŠ å¤åˆç´¢å¼•
CREATE INDEX idx_player_item_player_id ON life_player_item(player_id);
CREATE INDEX idx_player_skill_player_id ON life_player_skill(player_id);
```

#### 3. æ•°æ®ç±»å‹é€‰æ‹©

```sql
-- ä½¿ç”¨æ›´ç²¾ç¡®çš„æ•°æ®ç±»å‹
ALTER TABLE life_player MODIFY COLUMN experience BIGINT UNSIGNED;
ALTER TABLE life_player MODIFY COLUMN cultivation BIGINT UNSIGNED;
ALTER TABLE life_player MODIFY COLUMN spirit BIGINT UNSIGNED;
```

### æ€§èƒ½ä¼˜åŒ–å»ºè®®

#### 1. æŸ¥è¯¢ä¼˜åŒ–

```sql
-- ä½¿ç”¨EXPLAINåˆ†ææŸ¥è¯¢è®¡åˆ’
EXPLAIN SELECT * FROM life_player 
WHERE user_id = 'test_user' 
AND game_status = 0;

-- é¿å…å…¨è¡¨æ‰«æ
CREATE INDEX idx_player_status ON life_player(game_status);
```

#### 2. åˆ†åŒºç­–ç•¥

```sql
-- å¯¹å¤§å‹è¡¨è¿›è¡Œåˆ†åŒº
ALTER TABLE life_player 
PARTITION BY RANGE (YEAR(create_time)) (
    PARTITION p2024 VALUES LESS THAN (2025),
    PARTITION p2025 VALUES LESS THAN (2026),
    PARTITION p_future VALUES LESS THAN MAXVALUE
);
```

#### 3. ç¼“å­˜ç­–ç•¥

```sql
-- é…ç½®æŸ¥è¯¢ç¼“å­˜
SET GLOBAL query_cache_size = 64 * 1024 * 1024;
SET GLOBAL query_cache_type = 1;
```

### å®‰å…¨åŠ å›ºæªæ–½

#### 1. è®¿é—®æ§åˆ¶

```sql
-- åˆ›å»ºåªè¯»ç”¨æˆ·
CREATE USER 'bot_reader'@'%' IDENTIFIED BY 'reader_password';
GRANT SELECT ON bot.* TO 'bot_reader'@'%';

-- åˆ›å»ºå—é™ç”¨æˆ·
CREATE USER 'bot_app'@'%' IDENTIFIED BY 'app_password';
GRANT SELECT, INSERT, UPDATE ON bot.life_player TO 'bot_app'@'%';
REVOKE DELETE ON bot.* FROM 'bot_app'@'%';
```

#### 2. æ•°æ®åŠ å¯†

```sql
-- å¯ç”¨ä¼ è¾“åŠ å¯†
SET GLOBAL ssl_ca = '/path/to/ca-cert.pem';
SET GLOBAL ssl_cert = '/path/to/server-cert.pem';
SET GLOBAL ssl_key = '/path/to/server-key.pem';
```

#### 3. å®¡è®¡æ—¥å¿—

```sql
-- å¯ç”¨å®¡è®¡æ—¥å¿—
SET GLOBAL audit_log_policy = 'ALL';
SET GLOBAL audit_log_format = 'JSON';
```

### å¤‡ä»½å’Œæ¢å¤ç­–ç•¥

#### 1. å®šæœŸå¤‡ä»½

```bash
#!/bin/bash
# æ•°æ®åº“å¤‡ä»½è„šæœ¬

BACKUP_DIR="/backup/mysql"
DATE=$(date +%Y%m%d_%H%M%S)
DB_NAME="bot"

mkdir -p $BACKUP_DIR

# å…¨é‡å¤‡ä»½
mysqldump -u root -p$MYSQL_PASSWORD \
    --single-transaction \
    --routines \
    --triggers \
    --databases $DB_NAME \
    > $BACKUP_DIR/$DB_NAME-full-$DATE.sql

# å‹ç¼©å¤‡ä»½æ–‡ä»¶
gzip $BACKUP_DIR/$DB_NAME-full-$DATE.sql

echo "å¤‡ä»½å®Œæˆ: $BACKUP_DIR/$DB_NAME-full-$DATE.sql.gz"
```

#### 2. å¢é‡å¤‡ä»½

```bash
# å¢é‡å¤‡ä»½é…ç½®
SET GLOBAL binlog_format = 'ROW';
SET GLOBAL log_bin = 'mysql-bin';
SET GLOBAL expire_logs_days = 7;
```

#### 3. æ¢å¤æµ‹è¯•

```bash
# æ¢å¤æµ‹è¯•è„šæœ¬
TEST_DB="bot_test"
RESTORE_FILE="$BACKUP_DIR/$DB_NAME-full-latest.sql.gz"

# åˆ›å»ºæµ‹è¯•æ•°æ®åº“
mysql -u root -p$MYSQL_PASSWORD -e "CREATE DATABASE IF NOT EXISTS $TEST_DB;"

# æ¢å¤æ•°æ®
gunzip -c $RESTORE_FILE | mysql -u root -p$MYSQL_PASSWORD $TEST_DB

# éªŒè¯æ•°æ®å®Œæ•´æ€§
mysql -u root -p$MYSQL_PASSWORD -D $TEST_DB -e "
SELECT 'éªŒè¯è¡¨ç»“æ„' as test, COUNT(*) as count FROM information_schema.tables WHERE table_schema='$TEST_DB';
SELECT 'éªŒè¯å…³é”®æ•°æ®' as test, COUNT(*) as count FROM life_player WHERE level > 1;
"
```

### ç›‘æ§å’Œç»´æŠ¤

#### 1. æ€§èƒ½ç›‘æ§

```sql
-- ç›‘æ§æ…¢æŸ¥è¯¢
SELECT 
    query_time,
    lock_time,
    rows_sent,
    rows_examined,
    sql_text
FROM performance_schema.events_statements_summary_by_digest 
WHERE query_time > 1000000  -- è¶…è¿‡1ç§’çš„æŸ¥è¯¢
ORDER BY query_time DESC;
```

#### 2. ç©ºé—´ç®¡ç†

```sql
-- ç›‘æ§è¡¨ç©ºé—´ä½¿ç”¨
SELECT 
    table_schema,
    table_name,
    ROUND((data_length + index_length) / 1024 / 1024, 2) as size_mb
FROM information_schema.tables 
WHERE table_schema = 'bot'
ORDER BY size_mb DESC;
```

#### 3. å®šæœŸç»´æŠ¤

```sql
-- ä¼˜åŒ–è¡¨
OPTIMIZE TABLE life_player;
OPTIMIZE TABLE life_game_status;

-- æ¸…ç†å†å²æ•°æ®
DELETE FROM life_temp_files WHERE expire_time < NOW();
```

é€šè¿‡éµå¾ªè¿™äº›æœ€ä½³å®è·µï¼Œå¯ä»¥ç¡®ä¿æµ®ç”Ÿå·æ¨¡å—çš„æ•°æ®åº“ç³»ç»Ÿç¨³å®šã€é«˜æ•ˆã€å®‰å…¨åœ°è¿è¡Œï¼Œä¸ºæ¸¸æˆç”¨æˆ·æä¾›ä¼˜è´¨çš„ä¿®ä»™ä½“éªŒã€‚